version: '3'

networks:
  cloud_net:
    name: nextcloud

services:
  db:
    image: mariadb:10.8.3
    container_name: cloud_db
    restart: always
    command: --transaction-isolation=READ-COMMITTED --binlog-format=ROW --innodb-file-per-table=1 --skip-innodb-read-only-compressed
    volumes:
      ./cloud_db:/var/lib/mysql
    environment:
      - MYSQL_USER=yuikuen
      - MYSQL_DATABASE=mycloud
      - MYSQL_PASSWORD=Sinath@90
      - MYSQL_ROOT_PASSWORD=Sinath@700188..
    networks:
      - cloud_net

  cache:
    image: redis:alpine
    container_name: cloud_redis
    restart: unless-stopped
    expose:
      - 6379
    volumes:
      - ./cloud_cache:/data
    command: redis-server --requirepass 'Sinath@90'
    networks:
      - cloud_net

  app:
    image: nextcloud:24.0.3-apache
    container_name: cloud_app
    restart: unless-stopped
    volumes:
      - ./cloud_app:/var/www/html
    environment:
      - MYSQL_HOST=db
      - MYSQL_USER=yuikuen
      - MYSQL_DATABASE=mycloud
      - MYSQL_PASSWORD=Sinath@90
    ports:
      - 80:80
    networks:
      - cloud_net




  